---
interface Props {
	allTags: string[];
	activeTags?: string[];
	basePath?: string;
}

const { allTags, activeTags = [], basePath = '/blog' } = Astro.props;
const activeTagSet = new Set(activeTags);

const buildHref = (tags: string[]) =>
	tags.length > 0
		? `${basePath}?tags=${tags.map((tag) => encodeURIComponent(tag)).join(',')}`
		: basePath;

const toggleHref = (tag: string) => {
	const isActive = activeTagSet.has(tag);
	const nextTags = isActive ? activeTags.filter((t) => t !== tag) : [...activeTags, tag];
	// Keep query params stable for easier sharing/copying
	const uniqueNext = Array.from(new Set(nextTags)).sort((a, b) => a.localeCompare(b));
	return buildHref(uniqueNext);
};
---

<aside class="tag-sidebar meta-card">
	<h3>标签</h3>
	<ul class="tag-list">
		<li>
			<a
				href={buildHref([])}
				class:list={['tag-chip', { active: activeTags.length === 0 }]}
			>
				全部
			</a>
		</li>
		{
			allTags.map((tag) => (
				<li>
					<a
						href={toggleHref(tag)}
						class:list={['tag-chip', { active: activeTagSet.has(tag) }]}
						aria-pressed={activeTagSet.has(tag) ? 'true' : 'false'}
					>
						{tag}
					</a>
				</li>
			))
		}
	</ul>
</aside>

<style>
	.tag-sidebar h3 {
		margin: 0 0 1em 0;
		font-size: 1rem;
		font-weight: 600;
		color: rgb(var(--black));
	}
	.tag-list {
		list-style: none;
		padding: 0;
		margin: 0;
		display: flex;
		flex-direction: column;
		gap: 0.35rem;
	}
	.tag-list li {
		margin: 0;
	}
	.tag-list a {
		display: inline-block;
		text-decoration: none;
	}

	.tag-chip {
		padding: 0.35rem 0.75rem;
		border-radius: 999px;
		background: rgba(var(--accent), 0.08);
		color: rgb(var(--gray-dark));
		font-size: 0.85rem;
		transition: background-color 0.2s, color 0.2s;
	}

	.tag-chip.active {
		background: rgba(var(--accent), 0.16);
		color: rgb(var(--accent));
		font-weight: 600;
	}

	.tag-chip:hover {
		background: rgba(var(--accent), 0.22);
	}
</style>

